version: '2'

services:
  vm-store:
    image: mariadb:latest
    restart: always
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_DATABASE=vm
      - MYSQL_USER=${DATABASE_USER}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
  vm-agent:
    depends_on:
      - "vm-store"
      - "kafka"
    image: cloudiator/vm-agent:latest
    restart: always
    environment:
      - JPA_USER=${DATABASE_USER}
      - JPA_PASSWORD=${DATABASE_PASSWORD}
      - JPA_DATABASE=vm
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - JPA_HOST=vm-store
  node-store:
    image: mariadb:latest
    restart: always
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_DATABASE=node
      - MYSQL_USER=${DATABASE_USER}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
  node-agent:
    depends_on:
      - "node-store"
      - "kafka"
    image: cloudiator/node-agent:latest
    restart: always
    environment:
      - JPA_USER=${DATABASE_USER}
      - JPA_PASSWORD=${DATABASE_PASSWORD}
      - JPA_DATABASE=node
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - JPA_HOST=node-store
  discovery-store:
    image: mariadb:latest
    restart: always
    environment:
      - MYSQL_RANDOM_ROOT_PASSWORD=yes
      - MYSQL_DATABASE=discovery
      - MYSQL_USER=${DATABASE_USER}
      - MYSQL_PASSWORD=${DATABASE_PASSWORD}
  discovery-agent:
    depends_on:
      - "discovery-store"
      - "kafka"
    image: cloudiator/discovery-agent:latest
    restart: always
    environment:
      - JPA_USER=${DATABASE_USER}
      - JPA_PASSWORD=${DATABASE_PASSWORD}
      - JPA_DATABASE=discovery
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - JPA_HOST=discovery-store
  matchmaking-agent:
    depends_on:
      - "kafka"
    image: cloudiator/matchmaking-agent:latest
    restart: always
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
  rest-server:
    depends_on:
      - "kafka"
    image: cloudiator/rest-server:latest
    environment:
      - KAFKA_BOOTSTRAP_SERVERS=kafka:9092
      - SECURITY_API_KEY
    ports:
      - 9000:9000
  kafka:
    image: spotify/kafka
    restart: always
